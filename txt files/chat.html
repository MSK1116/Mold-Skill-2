<!DOCTYPE html>
<html>
  <head>
    <title>Discussion Page</title>
    <style>
      #opinions {
        list-style-type: none;
        padding: 0;
      }

      #opinions li {
        margin-bottom: 10px;
        border: 1px solid #ccc;
        padding: 10px;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script>
  </head>
  <body>
    <h1>Discussion Page</h1>

    <input type="file" id="imageFile" accept="image/*" />
    <br />
    <textarea id="opinion" placeholder="Enter your opinion"></textarea>
    <br />
    <button onclick="postOpinion()">Post</button>

    <h2>Opinions:</h2>
    <ul id="opinions"></ul>

    <script>
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC9JYxmu2_9EovJdkrd3W4vII5u6nInMfA",
        authDomain: "mold-skill-eafde.firebaseapp.com",
        databaseURL: "https://mold-skill-eafde-default-rtdb.firebaseio.com",
        projectId: "mold-skill-eafde",
        storageBucket: "mold-skill-eafde.appspot.com",
        messagingSenderId: "648939616010",
        appId: "1:648939616010:web:11f7961cc838f25e262cf3",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Retrieve a reference to the Firebase database
      var database = firebase.database();

      // Get the reference to the "opinions" node in the database
      var opinionsRef = database.ref("opinions");

      // Listen for new opinions and update the UI
      opinionsRef.on("child_added", function (data) {
        var opinion = data.val();

        var listItem = document.createElement("li");
        listItem.textContent = opinion;

        var opinionsList = document.getElementById("opinions");
        opinionsList.appendChild(listItem);
      });

      function postOpinion() {
        var opinion = document.getElementById("opinion").value;
        var file = document.getElementById("imageFile").files[0];

        if (file) {
          var storageRef = firebase.storage().ref("images/" + file.name);

          // Upload the image file to Firebase Storage
          var uploadTask = storageRef.put(file);

          // Get the download URL of the uploaded image and save the opinion with the URL
          uploadTask.then(function () {
            storageRef.getDownloadURL().then(function (url) {
              opinionsRef.push({
                opinion: opinion,
                imageUrl: url,
              });
            });
          });
        } else {
          // If no image is selected, save only the opinion without an image URL
          opinionsRef.push({
            opinion: opinion,
          });
        }

        document.getElementById("opinion").value = "";
        document.getElementById("imageFile").value = null;
      }
    </script>
  </body>
</html>
