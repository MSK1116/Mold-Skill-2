<!DOCTYPE html>
<html>
  <head>
    <title>Discussion Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      .chat-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      .message {
        margin-bottom: 10px;
        padding: 10px;
        background-color: #f1f1f1;
        border-radius: 5px;
      }

      .message p {
        margin: 0;
      }

      .message .sender {
        font-weight: bold;
      }

      .message .timestamp {
        font-size: 12px;
        color: #888;
      }

      .message img {
        max-width: 100%;
        border-radius: 5px;
        margin-top: 10px;
      }

      .input-area {
        display: flex;
        margin-top: 10px;
      }

      .input-area input[type="text"],
      .input-area input[type="email"],
      .input-area textarea {
        flex: 1;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }

      .input-area button {
        margin-left: 10px;
        padding: 5px 10px;
        background-color: #4caf50;
        color: #fff;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script>
  </head>
  <body>
    <div class="chat-container">
      <h1>Discussion Page</h1>

      <div id="chat-messages"></div>

      <div class="input-area">
        <input type="text" id="username" placeholder="Enter your username" />
        <input type="email" id="email" placeholder="Enter your email" />
        <textarea id="opinion" placeholder="Enter your opinion"></textarea>
        <input type="file" id="imageFile" accept="image/*" />
        <button onclick="postOpinion()">Send</button>
      </div>
    </div>

    <script>
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC9JYxmu2_9EovJdkrd3W4vII5u6nInMfA",
        authDomain: "mold-skill-eafde.firebaseapp.com",
        databaseURL: "https://mold-skill-eafde-default-rtdb.firebaseio.com",
        projectId: "mold-skill-eafde",
        storageBucket: "mold-skill-eafde.appspot.com",
        messagingSenderId: "648939616010",
        appId: "1:648939616010:web:11f7961cc838f25e262cf3",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Retrieve a reference to the Firebase database
      var database = firebase.database();

      // Get the reference to the "opinions" node in the database
      var opinionsRef = database.ref("opinions");

      // Listen for new opinions and update the UI
      opinionsRef.on("child_added", function (data) {
        var opinion = data.val();
        displayMessage(opinion);
      });

      function displayMessage(opinion) {
        var chatMessages = document.getElementById("chat-messages");

        var messageContainer = document.createElement("div");
        messageContainer.classList.add("message");

        var sender = document.createElement("p");
        sender.classList.add("sender");
        sender.textContent = opinion.sender;

        var text = document.createElement("p");
        text.textContent = opinion.opinion;

        var timestamp = document.createElement("p");
        timestamp.classList.add("timestamp");
        timestamp.textContent = formatDate(opinion.timestamp);

        messageContainer.appendChild(sender);
        messageContainer.appendChild(text);
        messageContainer.appendChild(timestamp);

        if (opinion.imageUrl) {
          var image = document.createElement("img");
          image.src = opinion.imageUrl;
          messageContainer.appendChild(image);
        }

        chatMessages.appendChild(messageContainer);
      }

      function postOpinion() {
        var opinion = document.getElementById("opinion").value;
        var sender = document.getElementById("username").value;
        var email = document.getElementById("email").value;
        var file = document.getElementById("imageFile").files[0];

        if (file) {
          var storageRef = firebase.storage().ref("images/" + file.name);

          // Upload the image file to Firebase Storage
          var uploadTask = storageRef.put(file);

          // Get the download URL of the uploaded image and save the opinion with the URL
          uploadTask.then(function () {
            storageRef.getDownloadURL().then(function (url) {
              opinionsRef.push({
                sender: sender,
                email: email,
                opinion: opinion,
                imageUrl: url,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
              });
            });
          });
        } else {
          // If no image is selected, save the opinion without an image URL
          opinionsRef.push({
            sender: sender,
            email: email,
            opinion: opinion,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
          });
        }

        document.getElementById("opinion").value = "";
        document.getElementById("username").value = "";
        document.getElementById("email").value = "";
        document.getElementById("imageFile").value = null;
      }

      function formatDate(timestamp) {
        var date = new Date(timestamp);
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? "PM" : "AM";
        hours %= 12;
        hours = hours || 12;
        minutes = minutes < 10 ? "0" + minutes : minutes;
        var formattedTime = hours + ":" + minutes + " " + ampm;
        return formattedTime;
      }
    </script>
  </body>
</html>
