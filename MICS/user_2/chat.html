<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- MSG TO BLOCKER -->
    <script async src="https://fundingchoicesmessages.google.com/i/pub-9494024234731058?ers=1" nonce="jWe20h_ndfsauY9014ZNFA"></script>
    <script nonce="jWe20h_ndfsauY9014ZNFA">
      (function () {
        function signalGooglefcPresent() {
          if (!window.frames["googlefcPresent"]) {
            if (document.body) {
              const iframe = document.createElement("iframe");
              iframe.style = "width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;";
              iframe.style.display = "none";
              iframe.name = "googlefcPresent";
              document.body.appendChild(iframe);
            } else {
              setTimeout(signalGooglefcPresent, 0);
            }
          }
        }
        signalGooglefcPresent();
      })();
    </script>
    <!-- ./MSG TO AD-BLOCKER -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta
      name="description"
      content="Discuss-Mold Skill is the simple portal for the students where any one can discuss with others without any authnetication. you can send message click the picture of your question and many more" />

    <meta property="og:image" content="https://i.postimg.cc/qqjQF1B1/Discuss.png" />
    <meta property="og:type" content="Educational Materail for free for +2 level." />
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/jjFs0f9c/Blue-Background-PNG.png" />

    <!-- CHAT BOX -->
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script>
    <style>
      .msg-area {
        display: flex;
        height: 50%;
        overflow-y: scroll;
        overflow-x: hidden;
      }
      .image-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        grid-gap: 10px;
      }

      .image-preview {
        width: 100%;
        height: auto;
        object-fit: cover;
        aspect-ratio: 1/1; /* Maintains a square aspect ratio */
        cursor: grab;
      }

      .sender {
        color: #044cac;
        font-weight: bolder;
        margin-bottom: 0;
      }
      .delete-button {
        margin-bottom: 45px;
        border: 0;
        color: brown;
      }
      .txt {
        max-width: 70%;
        text-align: justify;
        word-wrap: break-word;
        word-break: break-all;
        border-color: crimson;
        background-color: aliceblue;
        border-radius: 4%;
        border: 3px solid whitesmoke;
      }
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        border-top-color: #000;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .progress-container {
        width: 100%;
        background-color: #f0f0f0;
        border-radius: 4px;
        height: 20px;
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .progress-bar {
        height: 100%;
        background-color: #42b983;
        border-radius: 4px;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        width: 0%;
        background-color: #42b983;
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #ffffff;
        font-size: 12px;
        font-weight: bold;
      }
    </style>
    <title>Discuss - Mold Skill</title>

    <!-- STYLE DIR-->

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
    <link href="../../Style Dir/style3.css" rel="stylesheet" />
    <link href="../../Style Dir/style1.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <!-- END OF STYLE DIR-->
  </head>

  <body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar">
        <!-- Starting of sidebar -->

        <li class="nav-item active">
          <a class="nav-link" href="../../index.html">
            <img class="logo" src="https://i.postimg.cc/jjFs0f9c/Blue-Background-PNG.png" alt="" />
            <hr class="sidebar-divider" />
            <i class="fa fa-home"></i>
            <span>Home Page</span></a
          >
        </li>
        <!-- Divider -->
        <hr class="sidebar-divider" />

        <!-- Heading -->
        <div class="sidebar-heading">Choose you subject (Quick Link)</div>

        <!-- Main items-->

        <li class="nav-item">
          <a class="nav-link collapsed" href="#phy" data-toggle="collapse" aria-expanded="true" aria-controls="collapseUtilities">
            <i class="fas fa-rocket"></i>
            <span>Physics</span>
          </a>
          <div id="phy" class="collapse" aria-labelledby="phy" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
              <h6 class="collapse-header active">Go through the links</h6>
              <a class="collapse-item" href="../../Physics Book/phy-book.html">Books</a>
              <a class="collapse-item" href="../../7.PHYSICS/MCQ (Physics)/MCQ-phy.html">MCQ</a>
              <a class="collapse-item" href="../../7.PHYSICS/Practise Question XI/Practise-Que-xi.html">Practise Question<small> Grade XI</small></a>
              <a class="collapse-item" href="../../7.PHYSICS/note-phy-xi/phy-grade-xi.html">Notes 11</a>
              <a class="collapse-item" href="../../7.PHYSICS/note-phy-xii/phy-grade-xii.html">Notes 12<small> Updating</small></a>
            </div>
          </div>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="#chm" data-toggle="collapse" aria-expanded="true" aria-controls="collapseUtilities">
            <i class="fas fa-flask"></i>
            <span>Chemistry</span>
          </a>
          <div id="chm" class="collapse" aria-labelledby="collapseUtilities" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
              <h6 class="collapse-header active">Go through the links</h6>
              <a class="collapse-item" href="../../1.CHEMISTRY/Grade XI lab file/chm-lab-xi.html">Lab File-1</a>
              <a class="collapse-item" href="../../1.CHEMISTRY/MCQ (Chemistry)/MCQ-chm.html">MCQ</a>
              <a class="collapse-item" href="../../1.CHEMISTRY/practise question XI/practise-que-chm-xi.html">Practise Question<small> Grade XI</small></a>
              <a class="collapse-item" href="../../1.CHEMISTRY/notes-chm-xi/chm-grade-xi.html">Notes 11<small> Updating</small></a>
              <a class="collapse-item" href="../../1.CHEMISTRY/notes-chm-xii/chm-grade-xii.html">Notes 12<small> Updating</small></a>
            </div>
          </div>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="#mat" data-toggle="collapse" aria-expanded="true" aria-controls="collapseUtilities">
            <i class="fas fa-calculator"></i>
            <span>Math</span>
          </a>
          <div id="mat" class="collapse" aria-labelledby="mat" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
              <h6 class="collapse-header active">Go through the links</h6>
              <a class="collapse-item" href="../../3.MATH/MCQ (Math)/MCQ-mat.html">MCQ</a>
              <a class="collapse-item" href="../../3.MATH/Practise-que-mat-xi/practise-que-mat-xi.html">Practise Question <small> Grade XI</small></a>
            </div>
          </div>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="#cop" data-toggle="collapse" aria-expanded="true" aria-controls="collapseUtilities">
            <i class="fas fa-desktop"></i>
            <span>Computer</span>
          </a>
          <div id="cop" class="collapse" aria-labelledby="collapseUtilities" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
              <h6 class="collapse-header active">Go through the links</h6>
              <a class="collapse-item" href="../../4.COMPUTER/practise-que-comp-xi/practise-que-comp-xi.html">Practise Question <small> Grade XI</small></a>
              <a class="collapse-item" href="../../4.COMPUTER/c programming/C++.html">C & C++ <small> Grade XI</small></a>
              <a class="collapse-item" href="../../4.COMPUTER//MCQ (Computer)/mcq-comp-xi.html"> MCQ</a>
            </div>
          </div>
        </li>
        <hr class="sidebar-divider" />
        <li class="nav-item">
          <a class="nav-link collapsed" href="#zoo" data-toggle="collapse" aria-expanded="true" aria-controls="collapseUtilities">
            <i class="fas fa-frog"></i>
            <span>Zoology</span>
          </a>
          <div id="zoo" class="collapse" aria-labelledby="collapseUtilities" data-parent="#accordionSidebar">
            <a class="collapse-item" target="_blank" href="https://user.msmahato.com.np"
              ><div class="bg-white collapse-inner rounded">
                <h6 class="collapse-header">Help Us to bring more <br />content. click me to join</h6>
              </div></a
            >
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="#bot" data-toggle="collapse" aria-expanded="true" aria-controls="collapseUtilities">
            <i class="fas fa-seedling"></i>
            <span>Botany</span>
          </a>
          <div id="bot" class="collapse" aria-labelledby="collapseUtilities" data-parent="#accordionSidebar">
            <a class="collapse-item" target="_blank" href="https://user.msmahato.com.np"
              ><div class="bg-white collapse-inner rounded">
                <h6 class="collapse-header">Help Us to bring more <br />content. click me to join</h6>
              </div></a
            >
          </div>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block" />

        <div class="text-center d-none d-md-inline">
          <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

        <!-- Sidebar Message -->

        <li class="nav-item mb-3">
          <div class="sidebar-card d-lg-flex">
            <img class="sidebar-card-illustration mb-2" src="https://i.postimg.cc/q7Z18qRN/Stable-rocket.gif" alt="..." />

            <p class="text-center mb-2">
              <strong>Quote of the Day</strong><br />
              It is in your hands to create a better world for all who live in it.
            </p>
          </div>
        </li>
      </ul>
      <!-- End of Sidebar -->

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
          <!-- Topbar -->
          <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
            <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
              <i class="fa fa-bars"></i>
            </button>

            <!-- Topbar Search -->

            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">
              <li class="no-arrow nav-icon">
                <a href="../../about_us.html" class="btn btn-primary btn-icon-split">
                  <span class="icon text-white-50"> <i class="fas fa-child"></i></span>
                  <span class="text fw-bold">About us</span>
                </a>
              </li>
            </ul>
          </nav>
          <!-- End of Topbar -->
          <div class="msg-area border-bottom-warning container-fluid">
            <div class="scrollable-div" id="chat-messages"></div>
          </div>
          <div class="input-area container-fluid">
            <h5 class="text-primary margin-top">Discuss with other members publicaly</h5>
            <div id="upload-progress"></div>
            <div class="form-group row">
              <div class="col-sm-6 mb-3 mb-sm-0">
                <input type="text" id="username" class="form-control form-control-user" placeholder="Enter Your Name" required />
              </div>
              <div class="col-sm-6">
                <input type="email" class="form-control form-control-user" id="email" placeholder="Enter your email" required />
              </div>
            </div>

            <div class="form-group row">
              <div class="col-sm-6 mb-3 mb-sm-0">
                <label for="imageFiles" class="btn btn-info">
                  <i class="fas fa-camera"></i>
                </label>
                <input type="file" id="imageFiles" accept="image/*" multiple onchange="updateFileNames()" style="display: none" />
                <span id="selectedFileNames"></span>
              </div>

              <div class="col-sm-5 mb-3 mb-sm-0">
                <textarea class="form-control form-control-user" id="opinion" placeholder="Type Your Message"></textarea>
              </div>
            </div>

            <div class="form-group row">
              <div class="col-sm-6">
                <input type="password" id="deleteCode" class="form-control form-control-user" placeholder="Enter delete code (Use to delete message later)" required />
              </div>
            </div>

            <button type="submit" class="btn btn-lg btn-warning" onclick="postOpinion()">Send</button>
          </div>
        </div>
      </div>

      <!-- End of Content Wrapper -->
    </div>

    <footer class="sticky-footer">
      <div>
        <p class="copyright">
          MOld SKILL <br />
          Contact: contact@msmahato.com.np <br />
          Adress: Bhaktapur-Nepal <br />
          Copyright &copy;(2023-025)
        </p>
      </div>
      <div class="container my-auto">
        <div class="copyright text-center my-auto"></div>
      </div>
    </footer>

    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-rocket"></i>
    </a>

    <!-- Scripted file-->
    <!-- Asked by console for the jquery requirement -->
    <script src="../../js/jquery 3.6.o.js"></script>
    <!-- Importnat for collapse and nav -->
    <script src="../../js/script4.js"></script>
    <!-- MIcs -->
    <script src="../../js/script1.js"></script>
    <!-- STarting pop effect -->
    <script src="../../js/script5.js"></script>

    <script>
      function updateFileNames() {
        var input = document.getElementById("imageFiles");
        var fileNameSpan = document.getElementById("selectedFileNames");

        if (input.files && input.files.length > 0) {
          var fileNames = Array.from(input.files).map((file) => file.name);
          var displayText = fileNames.slice(0, 1) + (fileNames.length > 1 ? " and " + (fileNames.length - 1) + " more" : "");
          fileNameSpan.textContent = displayText;
        } else {
          fileNameSpan.textContent = "";
        }
      }

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC9JYxmu2_9EovJdkrd3W4vII5u6nInMfA",
        authDomain: "mold-skill-eafde.firebaseapp.com",
        databaseURL: "https://mold-skill-eafde-default-rtdb.firebaseio.com",
        projectId: "mold-skill-eafde",
        storageBucket: "mold-skill-eafde.appspot.com",
        messagingSenderId: "648939616010",
        appId: "1:648939616010:web:11f7961cc838f25e262cf3",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Retrieve a reference to the Firebase database
      var database = firebase.database();

      // Get the reference to the "opinions" node in the database
      var opinionsRef = database.ref("opinions");

      // Listen for new opinions and update the UI
      opinionsRef.on("child_added", function (data) {
        var opinion = data.val();
        displayMessage(opinion, data.key);
      });

      function displayMessage(opinion, messageId) {
        var chatMessages = document.getElementById("chat-messages");

        var messageContainer = document.createElement("div");
        messageContainer.classList.add("message-container");

        var sender = document.createElement("p");
        sender.classList.add("sender");
        sender.textContent = "By: " + opinion.sender;

        var timestamp = document.createElement("p");
        timestamp.classList.add("timestamp");
        timestamp.textContent = "" + new Date(opinion.timestamp).toLocaleString();

        var text = document.createElement("p");
        text.classList.add("txt");
        text.textContent = "Opinion: " + opinion.opinion;

        var deleteButton = document.createElement("button");
        deleteButton.innerHTML = '<i class="fas fa-trash"></i> Delete';
        deleteButton.classList.add("delete-button");

        deleteButton.addEventListener("click", function () {
          var deleteCode = prompt("Enter the delete code:");
          if (deleteCode === opinion.deleteCode) {
            opinionsRef.child(messageId).remove();
            messageContainer.remove();
          } else {
            alert("The delete code you provided doesn't match.");
          }
        });

        messageContainer.appendChild(sender);
        messageContainer.appendChild(timestamp);
        messageContainer.appendChild(text);

        if (opinion.imageUrls && opinion.imageUrls.length > 0) {
          var imageContainer = document.createElement("div");
          imageContainer.classList.add("image-container");

          var loadedImages = 0;
          var numImages = opinion.imageUrls.length;

          function checkAllImagesLoaded() {
            loadedImages++;
            if (loadedImages === numImages) {
              imageContainer.removeChild(loadingSpinner);
            }
          }

          var loadingSpinner = document.createElement("div");
          loadingSpinner.classList.add("spinner");
          imageContainer.appendChild(loadingSpinner);

          for (var i = 0; i < opinion.imageUrls.length; i++) {
            var image = document.createElement("img");
            image.src = opinion.imageUrls[i];
            image.classList.add("image-preview");

            var imageLink = document.createElement("a");
            imageLink.href = opinion.imageUrls[i];
            imageLink.target = "_blank"; // Open the link in a new tab/window

            imageLink.appendChild(image);
            imageContainer.appendChild(imageLink);

            // Listen for the load event of each image
            image.addEventListener("load", checkAllImagesLoaded);

            // Listen for the error event of each image
            image.addEventListener("error", checkAllImagesLoaded);
          }

          messageContainer.appendChild(imageContainer);
        }

        messageContainer.appendChild(deleteButton);
        chatMessages.appendChild(messageContainer);
      }

      function postOpinion() {
        var username = document.getElementById("username").value;
        var email = document.getElementById("email").value;
        var opinion = document.getElementById("opinion").value;
        var deleteCode = document.getElementById("deleteCode").value;
        var files = document.getElementById("imageFiles").files;

        if (validateInputs(username, email, opinion, deleteCode, files)) {
          var imageUrls = [];

          if (files.length > 0 && files.length <= 5) {
            var fileCount = files.length;
            var uploadedCount = 0;
            var processedFilenames = [];

            var progressBar = document.createElement("div");
            progressBar.classList.add("progress-bar");

            var progressFill = document.createElement("div");
            progressFill.classList.add("progress-fill");
            progressBar.appendChild(progressFill);

            var progressText = document.createElement("div");
            progressText.classList.add("progress-text");
            progressText.textContent = "Uploading...";
            progressBar.appendChild(progressText);

            var progressContainer = document.createElement("div");
            progressContainer.classList.add("progress-container");
            progressContainer.appendChild(progressBar);

            document.getElementById("upload-progress").appendChild(progressContainer);

            for (var i = 0; i < fileCount; i++) {
              var file = files[i];
              if (file.size <= 4 * 1024 * 1024) {
                if (processedFilenames.includes(file.name)) {
                  alert("File with name " + file.name + " has already been uploaded. Skipping duplicate file.");
                  continue;
                }

                processedFilenames.push(file.name);

                uploadFile(file, username, email, opinion, deleteCode, imageUrls, fileCount, progressBar, function () {
                  uploadedCount++;

                  if (uploadedCount === fileCount) {
                    // All files have finished uploading
                    clearUploadProgress();
                    saveOpinion(username, email, opinion, deleteCode, imageUrls);
                  }
                });
              } else {
                alert("Please select image files smaller than 4 MB.");
                clearUploadProgress();
              }
            }
          } else if (files.length === 0) {
            saveOpinion(username, email, opinion, deleteCode, imageUrls);
          } else {
            alert("Please select up to 1-5 image files.");
          }

          clearInputs();
        }
      }

      function uploadFile(file, username, email, opinion, deleteCode, imageUrls, fileCount, progressBar, completeCallback) {
        var storageRef = firebase.storage().ref("images/" + file.name);
        var uploadTask = storageRef.put(file);

        uploadTask.on(
          "state_changed",
          function (snapshot) {
            // Update progress bar during upload
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            progressBar.firstChild.style.width = progress + "%";
          },
          function (error) {
            console.log(error);
            alert("An error occurred during upload. Please try again.");
            clearUploadProgress();
          },
          function () {
            // Upload completed successfully
            uploadTask.snapshot.ref.getDownloadURL().then(function (url) {
              imageUrls.push(url);
              completeCallback(); // Call the complete callback function
            });
          }
        );
      }

      function clearUploadProgress() {
        var uploadProgress = document.getElementById("upload-progress");
        uploadProgress.innerHTML = "";
      }

      function saveOpinion(username, email, opinion, deleteCode, imageUrls) {
        opinionsRef.push({
          sender: username,
          email: email,
          opinion: opinion,
          deleteCode: deleteCode,
          imageUrls: imageUrls,
          timestamp: new Date().getTime(),
        });
      }

      function validateInputs(username, email, opinion, deleteCode, files) {
        if (!username || !email || !opinion || !deleteCode) {
          alert("Please fill in all the required fields.");
          return false;
        }

        if (!isValidEmail(email)) {
          alert("Please enter a valid email address.");
          return false;
        }

        if (files && files.length > 0) {
          for (var i = 0; i < files.length; i++) {
            var file = files[i];
            if (file.size > 4 * 1024 * 1024) {
              alert("Please select image files smaller than 4 MB.");
              return false;
            }
          }
        }

        return true;
      }

      function isValidEmail(email) {
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      function clearInputs() {
        document.getElementById("opinion").value = "";
        document.getElementById("deleteCode").value = "";
        document.getElementById("imageFiles").value = null;
        document.getElementById("selectedFileNames").textContent = "";
      }
    </script>
  </body>
</html>
